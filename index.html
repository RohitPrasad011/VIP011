<!DOCTYPE html>
<html>
<head>
  <title>Restaurant System</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

<div id="authSection">
  <h2 class="text-xl font-bold mb-2">Login</h2>
  <input id="mobile" placeholder="Mobile" class="border p-2 w-full mb-2">
  <input id="password" type="password" placeholder="Password" class="border p-2 w-full mb-2">
  <button onclick="login()" class="bg-blue-500 text-white p-2 w-full">Login</button>

  <hr class="my-4">

  <h2 class="text-xl font-bold mb-2">Signup</h2>
  <input id="s_mobile" placeholder="Mobile" class="border p-2 w-full mb-2">
  <input id="s_password" type="password" placeholder="Password" class="border p-2 w-full mb-2">
  <input id="s_name" placeholder="Name" class="border p-2 w-full mb-2">
  <button onclick="signup()" class="bg-green-500 text-white p-2 w-full">Create Account</button>
</div>

<div id="dashboard" class="hidden">
  <h2 id="welcome" class="text-xl font-bold mb-4"></h2>
  <div id="content"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxYSzeKTCxXn3RNswlpp8Yo6wbd6F4W7XcKE76LbZ4GEFe3NjQELlr7xJcA3HorQjh3/exec";

let currentUser = {};

function signup() {
  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "signup",
      mobile: document.getElementById("s_mobile").value,
      password: document.getElementById("s_password").value,
      name: document.getElementById("s_name").value
    })
  })
  .then(res => res.json())
  .then(data => alert(data.message));
}

function login() {
  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "login",
      mobile: document.getElementById("mobile").value,
      password: document.getElementById("password").value
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.role) {
      currentUser.mobile = document.getElementById("mobile").value;
      currentUser.role = data.role;
      currentUser.name = data.name;
      showDashboard();
    } else {
      alert(data.message);
    }
  });
}

function showDashboard() {
  document.getElementById("authSection").classList.add("hidden");
  document.getElementById("dashboard").classList.remove("hidden");
  document.getElementById("welcome").innerText =
    "Welcome " + currentUser.name + " (" + currentUser.role + ")";

  if (currentUser.role === "admin") {
    loadOrders();
  } else {
    loadMenu();
  }
}

function loadMenu() {
  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "getMenu" })
  })
  .then(res => res.json())
  .then(menu => {
    let html = "<h3 class='font-bold mb-2'>Menu</h3>";
    menu.forEach(item => {
      html += `<div class="border p-2 mb-2">
        ${item.name} - ₹${item.price}
        <button onclick="placeOrder('${item.name}', ${item.price})"
        class="bg-orange-500 text-white px-2 py-1 ml-2">Order</button>
      </div>`;
    });
    document.getElementById("content").innerHTML = html;
  });
}

function placeOrder(item, price) {
  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "placeOrder",
      mobile: currentUser.mobile,
      items: item,
      total: price,
      address: "Customer Address"
    })
  })
  .then(res => res.json())
  .then(data => alert(data.message));
}

function loadOrders() {
  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "getOrders",
      mobile: currentUser.mobile,
      role: currentUser.role
    })
  })
  .then(res => res.json())
  .then(orders => {
    let html = "<h3 class='font-bold mb-2'>All Orders</h3>";
    orders.forEach(order => {
      html += `<div class="border p-2 mb-2">
        Order ID: ${order.orderId}<br>
        Items: ${order.items}<br>
        Total: ₹${order.total}<br>
        Status: ${order.status}
      </div>`;
    });
    document.getElementById("content").innerHTML = html;
  });
}
</script>

</body>
</html>
