<!DOCTYPE html>
<html>
<head>
  <title>VIP Food Service</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

<div id="authSection">
  <h2 class="text-xl font-bold mb-2">Login</h2>
  <input id="mobile" placeholder="Mobile" class="border p-2 w-full mb-2">
  <input id="password" type="password" placeholder="Password" class="border p-2 w-full mb-2">
  <button onclick="login()" class="bg-blue-500 text-white p-2 w-full">Login</button>

  <hr class="my-4">

  <h2 class="text-xl font-bold mb-2">Signup</h2>
  <input id="s_mobile" placeholder="Mobile" class="border p-2 w-full mb-2">
  <input id="s_password" type="password" placeholder="Password" class="border p-2 w-full mb-2">
  <input id="s_name" placeholder="Name" class="border p-2 w-full mb-2">
  <button onclick="signup()" class="bg-green-500 text-white p-2 w-full">Create Account</button>
</div>

<div id="dashboard" class="hidden">
  <h2 id="welcome" class="text-xl font-bold mb-4"></h2>
  <div id="content"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwQBiWPqXDtqbZbRLRQuambC5NoisJ_i-BGw3w3JbiCy2y_N6lOiOOPhkxLucpVSqpk/exec";

let currentUser = {};

async function request(data) {
  const formData = new URLSearchParams();
  formData.append("data", JSON.stringify(data));

  const res = await fetch(API_URL, {
    method: "POST",
    body: formData
  });
  return res.json();
}

function signup() {
  const data = {
    action: "signup",
    mobile: s_mobile.value,
    password: s_password.value,
    name: s_name.value
  };
  request(data).then(d => alert(d.message));
}

function login() {
  const data = {
    action: "login",
    mobile: mobile.value,
    password: password.value
  };
  request(data).then(d => {
    if (d.role) {
      currentUser.mobile = mobile.value;
      currentUser.role = d.role;
      currentUser.name = d.name;
      showDashboard();
    } else {
      alert(d.message);
    }
  });
}

function showDashboard() {
  authSection.classList.add("hidden");
  dashboard.classList.remove("hidden");
  welcome.innerText = "Welcome " + currentUser.name + " (" + currentUser.role + ")";

  if (currentUser.role === "admin") {
    loadOrders();
  } else {
    loadMenu();
  }
}

function loadMenu() {
  request({ action: "getMenu" }).then(menu => {
    let html = "<h3 class='font-bold mb-2'>Menu</h3>";
    menu.forEach(item => {
      html += `<div class="border p-2 mb-2">
        ${item.name} - ₹${item.price}
        <button onclick="placeOrder('${item.name}', ${item.price})"
        class="bg-orange-500 text-white px-2 py-1 ml-2">Order</button>
      </div>`;
    });
    content.innerHTML = html;
  });
}

function placeOrder(item, price) {
  const data = {
    action: "placeOrder",
    mobile: currentUser.mobile,
    items: item,
    total: price,
    address: "Customer Address"
  };
  request(data).then(d => alert(d.message));
}

function loadOrders() {
  request({ action: "getOrders", mobile: currentUser.mobile, role: currentUser.role })
    .then(orders => {
      let html = "<h3 class='font-bold mb-2'>Orders</h3>";
      orders.forEach(o => {
        html += `<div class="border p-2 mb-2">
          Order ID: ${o.orderId}<br>
          Items: ${o.items}<br>
          Total: ₹${o.total}<br>
          Status: ${o.status}
        </div>`;
      });
      content.innerHTML = html;
    });
}
</script>

</body>
</html>
