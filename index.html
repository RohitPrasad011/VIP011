<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Food Service - Premium Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .loader { border-top-color: #f97316; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .smooth-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
    </style>
</head>
<body class="bg-slate-50 font-sans">

    <div id="app-container" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative pb-20">
        
        <header class="bg-orange-600 text-white p-5 text-center shadow-lg">
            <h1 class="font-extrabold text-2xl tracking-tight italic">VIP FOOD SERVICE</h1>
            <p class="text-xs opacity-80 uppercase tracking-widest mt-1">Premium Quality & Speed</p>
        </header>

        <div id="global-loader" class="hidden absolute inset-0 bg-white/90 z-50 flex flex-col justify-center items-center">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-slate-200 h-14 w-14 mb-4"></div>
            <p class="font-semibold text-slate-600">Processing Request...</p>
        </div>

        <div id="view-login" class="p-8">
            <h2 class="text-3xl font-bold text-slate-800 text-center mb-10">Welcome Back</h2>
            <div class="space-y-4">
                <input type="number" id="auth-login-mobile" placeholder="Mobile Number" class="w-full p-4 border rounded-xl outline-none focus:ring-2 focus:ring-orange-500">
                <input type="password" id="auth-login-pass" placeholder="Password" class="w-full p-4 border rounded-xl outline-none focus:ring-2 focus:ring-orange-500">
                <button onclick="executeLogin()" class="w-full bg-orange-600 text-white p-4 rounded-xl font-bold text-lg shadow-lg">Sign In</button>
            </div>
            <p class="text-center mt-10 text-slate-500">New member? <span class="text-orange-600 font-bold cursor-pointer underline" onclick="switchView('view-signup')">Create Account</span></p>
        </div>

        <div id="view-signup" class="p-8 hidden">
            <h2 class="text-3xl font-bold text-slate-800 text-center mb-8">Join Us</h2>
            <div class="space-y-4">
                <input type="text" id="reg-name" placeholder="Full Name" class="w-full p-4 border rounded-xl outline-none focus:ring-2 focus:ring-orange-500">
                <input type="number" id="reg-mobile" placeholder="Mobile Number" class="w-full p-4 border rounded-xl outline-none focus:ring-2 focus:ring-orange-500">
                <input type="password" id="reg-pass" placeholder="Set Password" class="w-full p-4 border rounded-xl outline-none focus:ring-2 focus:ring-orange-500">
                <button onclick="executeSignup()" class="w-full bg-slate-800 text-white p-4 rounded-xl font-bold text-lg shadow-lg">Register Account</button>
            </div>
            <p class="text-center mt-6 text-slate-500">Already registered? <span class="text-orange-600 font-bold cursor-pointer" onclick="switchView('view-login')">Sign In</span></p>
        </div>

        <div id="view-customer" class="hidden p-4">
            <div class="flex justify-between items-center mb-6 bg-orange-50 p-4 rounded-2xl">
                <h3 class="font-extrabold text-slate-800 text-lg" id="display-user-name">User</h3>
                <button onclick="location.reload()" class="bg-white text-red-500 px-4 py-2 rounded-xl text-xs font-bold border border-red-100">Sign Out</button>
            </div>
            <div id="menu-gallery" class="space-y-4 mb-80"></div>

            <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t p-5 shadow-[0_-10px_20px_rgba(0,0,0,0.1)] rounded-t-3xl">
                <div class="space-y-2 mb-3">
                    <input type="text" id="input-address" placeholder="House No. / Building Name" class="w-full p-2 border border-slate-200 rounded-lg text-sm outline-none">
                    <div class="flex gap-2">
                        <input type="text" id="input-city" placeholder="City / Area" class="flex-1 p-2 border border-slate-200 rounded-lg text-sm outline-none">
                        <input type="text" id="input-landmark" placeholder="Landmark" class="flex-1 p-2 border border-slate-200 rounded-lg text-sm outline-none">
                    </div>
                    <input type="text" id="input-location" placeholder="Paste Google Maps Link Here" class="w-full p-2 border border-orange-200 rounded-lg text-sm outline-none bg-orange-50">
                    <input type="text" id="input-utr" placeholder="Enter Payment UTR Number" class="w-full p-2 border border-orange-200 rounded-lg text-sm outline-none bg-orange-50 font-bold">
                </div>
                <button onclick="submitOrder()" class="w-full bg-orange-600 text-white p-4 rounded-2xl font-black flex justify-between px-8 shadow-xl shadow-orange-200">
                    <span>CONFIRM ORDER</span>
                    <span id="display-total-price">₹0</span>
                </button>
            </div>
        </div>

        <div id="view-admin" class="hidden p-4">
            <h2 class="text-2xl font-black mb-6 border-b pb-4">Admin <span class="text-orange-600">Portal</span></h2>
            <div id="admin-orders-list" class="space-y-4"></div>
        </div>

    </div>

    <script>
        const API_ENDPOINT = "https://script.google.com/macros/s/AKfycbxUYR7rGbF9GXcurSURzBsLCP8uh5nsvXSW7JwPinHCN-dJujR2YYhzHg9I83uQ69Vp/exec";
        let sessionUser = null;
        let selectedProduct = "None";
        let cartAmount = 0;

        function switchView(id) {
            document.querySelectorAll('#app-container > div:not(header):not(#global-loader)').forEach(v => v.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        async function executeLogin() {
            const mobile = document.getElementById('auth-login-mobile').value;
            const pass = document.getElementById('auth-login-pass').value;
            if(!mobile || !pass) return alert("Enter credentials.");
            document.getElementById('global-loader').classList.remove('hidden');
            const res = await fetch(API_ENDPOINT, { method: 'POST', body: JSON.stringify({ action: "login", mobile, password: pass }) });
            const data = await res.json();
            document.getElementById('global-loader').classList.add('hidden');
            if(data.status === "Success") {
                sessionUser = { ...data, mobile };
                document.getElementById('display-user-name').innerText = data.name;
                data.role === "Admin" ? fetchAdminDashboard() : fetchCustomerMenu();
            } else alert("Invalid Login.");
        }

        async function executeSignup() {
            const name = document.getElementById('reg-name').value;
            const mobile = document.getElementById('reg-mobile').value;
            const password = document.getElementById('reg-pass').value;
            if(!name || !mobile || !password) return alert("Fill all fields.");
            document.getElementById('global-loader').classList.remove('hidden');
            await fetch(API_ENDPOINT, { method: 'POST', body: JSON.stringify({ action: "signup", name, mobile, password, address: "", location: "" }) });
            document.getElementById('global-loader').classList.add('hidden');
            alert("Registered! Please login.");
            switchView('view-login');
        }

        async function fetchCustomerMenu() {
            switchView('view-customer');
            const res = await fetch(API_ENDPOINT + "?sheet=Menu");
            const products = await res.json();
            let template = '';
            products.forEach(p => {
                template += `<div class="bg-white rounded-3xl p-3 flex gap-4 smooth-shadow border border-slate-50">
                    <img src="${p.IMAGE}" class="w-24 h-24 object-cover rounded-2xl">
                    <div class="flex-1 flex flex-col justify-between">
                        <h4 class="font-black text-slate-800">${p.Name}</h4>
                        <div class="flex justify-between items-center">
                            <span class="text-orange-600 font-black">₹${p.Price}</span>
                            <button onclick="updateCart('${p.Name}', ${p.Price})" class="bg-slate-800 text-white px-4 py-2 rounded-xl text-xs font-bold">ADD</button>
                        </div>
                    </div>
                </div>`;
            });
            document.getElementById('menu-gallery').innerHTML = template;
        }

        function updateCart(name, price) {
            selectedProduct = name;
            cartAmount = price;
            document.getElementById('display-total-price').innerText = `₹${price}`;
        }

        async function submitOrder() {
            const addr = document.getElementById('input-address').value;
            const city = document.getElementById('input-city').value;
            const landmark = document.getElementById('input-landmark').value;
            const loc = document.getElementById('input-location').value;
            const utr = document.getElementById('input-utr').value;

            if(!addr || !city || !loc || !utr) return alert("Please provide Address, Maps Link, and UTR Number.");

            document.getElementById('global-loader').classList.remove('hidden');
            const res = await fetch(API_ENDPOINT, {
                method: 'POST',
                body: JSON.stringify({
                    action: "order",
                    mobile: sessionUser.mobile,
                    orderId: "ID-" + Date.now(),
                    details: selectedProduct + " | Addr: " + addr + ", " + city + " (" + landmark + ")",
                    total: cartAmount,
                    utr: utr,
                    location: loc
                })
            });
            const msg = await res.text();
            alert("Order Status: " + msg);
            location.reload();
        }

        async function fetchAdminDashboard() {
            switchView('view-admin');
            const res = await fetch(API_ENDPOINT + "?sheet=Orders");
            const orders = await res.json();
            let template = '';
            orders.reverse().forEach(o => {
                template += `<div class="bg-white p-5 rounded-3xl border-l-[6px] border-orange-500 smooth-shadow">
                    <p class="text-[10px] text-slate-400 font-bold tracking-tighter uppercase mb-1">${o.OrderID}</p>
                    <h4 class="font-black text-slate-800 mb-1">${o.OrderDetails}</h4>
                    <p class="text-sm text-slate-500 mb-3">Customer: ${o.CustomerMobile}</p>
                    <div class="bg-slate-50 p-3 rounded-2xl mb-4 border">
                        <p class="text-[10px] text-slate-400 font-bold uppercase">Transaction UTR</p>
                        <p class="text-sm font-black text-blue-700">${o.UTR_ID}</p>
                    </div>
                    <div class="flex gap-2">
                        <a href="${o.Location}" target="_blank" class="flex-1 bg-slate-800 text-white text-center py-3 rounded-xl text-xs font-bold uppercase">Maps</a>
                        <button onclick="window.open('https://wa.me/91${o.CustomerMobile}?text=Your order ${o.OrderID} is received.')" class="flex-1 bg-green-500 text-white py-3 rounded-xl text-xs font-bold uppercase">WhatsApp</button>
                    </div>
                </div>`;
            });
            document.getElementById('admin-orders-list').innerHTML = template || "<p class='text-center py-20 opacity-50'>No active orders.</p>";
        }
    </script>
</body>
</html>
