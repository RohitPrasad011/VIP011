<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Food Service - Premium Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .loader { border-top-color: #f97316; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .smooth-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
    </style>
</head>
<body class="bg-slate-50 font-sans">

    <div id="app-container" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative">
        
        <header class="bg-orange-600 text-white p-5 text-center shadow-lg">
            <h1 class="font-extrabold text-2xl tracking-tight italic">VIP FOOD SERVICE</h1>
            <p class="text-xs opacity-80 uppercase tracking-widest mt-1">Premium Quality & Speed</p>
        </header>

        <div id="global-loader" class="hidden absolute inset-0 bg-white/90 z-50 flex flex-col justify-center items-center">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-slate-200 h-14 w-14 mb-4"></div>
            <p class="font-semibold text-slate-600 animate-pulse">Processing Request...</p>
        </div>

        <div id="view-login" class="p-8">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-slate-800">Welcome Back</h2>
                <p class="text-slate-500 mt-2">Please sign in to your account</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-sm font-semibold text-slate-600 ml-1">Mobile Number</label>
                    <input type="number" id="auth-login-mobile" placeholder="e.g. 9876543210" class="w-full p-4 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none transition-all">
                </div>
                <div>
                    <label class="text-sm font-semibold text-slate-600 ml-1">Password</label>
                    <input type="password" id="auth-login-pass" placeholder="••••••••" class="w-full p-4 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none transition-all">
                </div>
                <button onclick="executeLogin()" class="w-full bg-orange-600 text-white p-4 rounded-xl font-bold text-lg hover:bg-orange-700 active:scale-95 transition-all shadow-lg">Sign In</button>
            </div>
            
            <p class="text-center mt-10 text-slate-500">
                New member? <span class="text-orange-600 font-bold cursor-pointer underline" onclick="switchView('view-signup')">Create Account</span>
            </p>
        </div>

        <div id="view-signup" class="p-8 hidden">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-slate-800">Join Us</h2>
                <p class="text-slate-500 mt-2">Create your premium account</p>
            </div>
            
            <div class="space-y-3">
                <input type="text" id="reg-name" placeholder="Full Name" class="w-full p-4 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-orange-500">
                <input type="number" id="reg-mobile" placeholder="Mobile Number" class="w-full p-4 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-orange-500">
                <input type="password" id="reg-pass" placeholder="Create Password" class="w-full p-4 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-orange-500">
                <input type="text" id="reg-address" placeholder="Delivery Address" class="w-full p-4 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-orange-500">
                <input type="text" id="reg-location" placeholder="Google Maps Link (Optional)" class="w-full p-4 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-orange-500">
                
                <button onclick="executeSignup()" class="w-full bg-slate-800 text-white p-4 rounded-xl font-bold text-lg hover:bg-slate-900 shadow-lg mt-4">Register Account</button>
            </div>
            <p class="text-center mt-6 text-slate-500">
                Already registered? <span class="text-orange-600 font-bold cursor-pointer" onclick="switchView('view-login')">Sign In</span>
            </p>
        </div>

        <div id="view-customer" class="hidden p-4">
            <div class="flex justify-between items-center mb-6 bg-orange-50 p-4 rounded-2xl">
                <div>
                    <p class="text-xs text-orange-600 font-bold uppercase">Welcome</p>
                    <h3 class="font-extrabold text-slate-800 text-lg" id="display-user-name">Guest User</h3>
                </div>
                <button onclick="location.reload()" class="bg-white text-red-500 px-4 py-2 rounded-xl text-xs font-bold shadow-sm border border-red-100">Sign Out</button>
            </div>
            
            <h3 class="font-extrabold text-slate-800 text-xl mb-4 pl-1">Exquisite Menu</h3>
            <div id="menu-gallery" class="space-y-4 mb-48">
                </div>

            <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-md border-t border-slate-100 p-5 shadow-[0_-10px_20px_rgba(0,0,0,0.05)] rounded-t-3xl">
                <div class="flex gap-2 mb-3">
                    <input type="text" id="input-utr" placeholder="Payment UTR Number" class="flex-1 p-3 border border-orange-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-orange-500">
                    <input type="text" id="input-location" placeholder="Maps Link" class="flex-1 p-3 border border-orange-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-orange-500">
                </div>
                <button onclick="submitOrder()" id="btn-checkout" class="w-full bg-orange-600 text-white p-4 rounded-2xl font-black text-lg shadow-xl shadow-orange-200 flex justify-between items-center px-8 transition-all active:scale-95">
                    <span>PLACE ORDER</span>
                    <span id="display-total-price">₹0</span>
                </button>
            </div>
        </div>

        <div id="view-admin" class="hidden p-4">
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <h2 class="text-2xl font-black text-slate-800">Admin <span class="text-orange-600">Portal</span></h2>
                <button onclick="location.reload()" class="bg-slate-100 text-slate-600 px-4 py-2 rounded-xl font-bold text-xs uppercase tracking-tighter">Exit Portal</button>
            </div>
            <div id="admin-orders-list" class="space-y-4">
                </div>
        </div>

    </div>

    <script>
        const API_ENDPOINT = "https://script.google.com/macros/s/AKfycbxUYR7rGbF9GXcurSURzBsLCP8uh5nsvXSW7JwPinHCN-dJujR2YYhzHg9I83uQ69Vp/exec";
        let sessionUser = null;
        let selectedProduct = "None";
        let cartAmount = 0;

        function switchView(id) {
            document.querySelectorAll('#app-container > div:not(header):not(#global-loader)').forEach(v => v.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function toggleLoading(status) {
            document.getElementById('global-loader').classList.toggle('hidden', !status);
        }

        async function executeLogin() {
            const mobile = document.getElementById('auth-login-mobile').value;
            const pass = document.getElementById('auth-login-pass').value;
            if(!mobile || !pass) return alert("Please enter credentials.");

            toggleLoading(true);
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    body: JSON.stringify({ action: "login", mobile: mobile, password: pass })
                });
                const result = await response.json();
                
                if(result.status === "Success") {
                    sessionUser = result;
                    sessionUser.mobile = mobile; 
                    document.getElementById('display-user-name').innerText = result.name;
                    result.role === "Admin" ? fetchAdminDashboard() : fetchCustomerMenu();
                } else {
                    alert("Invalid Authentication Details.");
                }
            } catch (e) { alert("Network Error: Connection Refused."); }
            toggleLoading(false);
        }

        async function executeSignup() {
            const payload = {
                action: "signup",
                name: document.getElementById('reg-name').value,
                mobile: document.getElementById('reg-mobile').value,
                password: document.getElementById('reg-pass').value,
                address: document.getElementById('reg-address').value,
                location: document.getElementById('reg-location').value
            };

            if(!payload.name || !payload.mobile || !payload.password) return alert("Required fields missing.");

            toggleLoading(true);
            await fetch(API_ENDPOINT, { method: 'POST', body: JSON.stringify(payload) });
            alert("Registration Successful. Please Login.");
            switchView('view-login');
            toggleLoading(false);
        }

        async function fetchCustomerMenu() {
            switchView('view-customer');
            const response = await fetch(API_ENDPOINT + "?sheet=Menu");
            const products = await response.json();
            let template = '';
            products.forEach(p => {
                template += `
                <div class="bg-white rounded-3xl p-3 flex gap-4 smooth-shadow border border-slate-50 transition-all hover:border-orange-200 group">
                    <img src="${p.IMAGE}" class="w-28 h-28 object-cover rounded-2xl group-hover:scale-105 transition-transform">
                    <div class="flex-1 flex flex-col justify-between py-1">
                        <div>
                            <h4 class="font-black text-slate-800">${p.Name}</h4>
                            <p class="text-[10px] text-slate-400 leading-tight mt-1 line-clamp-2">${p.Description}</p>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-orange-600 font-black text-lg">₹${p.Price}</span>
                            <button onclick="updateCart('${p.Name}', ${p.Price})" class="bg-slate-800 text-white px-5 py-2 rounded-xl text-xs font-bold hover:bg-orange-600 transition-colors">ADD</button>
                        </div>
                    </div>
                </div>`;
            });
            document.getElementById('menu-gallery').innerHTML = template;
        }

        function updateCart(name, price) {
            selectedProduct = name;
            cartAmount = price;
            document.getElementById('display-total-price').innerText = `₹${price}`;
            document.getElementById('btn-checkout').classList.add('animate-bounce');
            setTimeout(() => document.getElementById('btn-checkout').classList.remove('animate-bounce'), 500);
        }

        async function submitOrder() {
            const utr = document.getElementById('input-utr').value;
            const loc = document.getElementById('input-location').value;

            if(!utr || !loc) return alert("Security Check: Payment UTR and Delivery Location are Mandatory.");

            toggleLoading(true);
            const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                body: JSON.stringify({
                    action: "order",
                    mobile: sessionUser.mobile,
                    orderId: "ID-" + Math.floor(Math.random() * 900000 + 100000),
                    details: selectedProduct,
                    total: cartAmount,
                    utr: utr,
                    location: loc
                })
            });
            const feedback = await response.text();
            alert("Order Status: " + feedback);
            location.reload();
        }

        async function fetchAdminDashboard() {
            switchView('view-admin');
            const response = await fetch(API_ENDPOINT + "?sheet=Orders");
            const orders = await response.json();
            let template = '';
            orders.reverse().forEach(o => {
                template += `
                <div class="bg-white p-5 rounded-3xl border-l-[6px] border-orange-500 smooth-shadow relative overflow-hidden">
                    <div class="flex justify-between items-start mb-3">
                        <span class="bg-slate-100 text-slate-500 text-[10px] px-2 py-1 rounded-md font-bold uppercase tracking-tighter">${o.OrderID}</span>
                        <span class="text-xs font-black text-orange-600">₹${o.TotalBill}</span>
                    </div>
                    <h4 class="font-black text-slate-800 text-lg mb-1">${o.OrderDetails}</h4>
                    <p class="text-sm text-slate-500 mb-4">Customer: ${o.CustomerMobile}</p>
                    <div class="bg-slate-50 p-3 rounded-2xl mb-4 border border-slate-100">
                        <p class="text-xs text-slate-400 font-semibold uppercase italic">UTR/Transaction ID</p>
                        <p class="text-sm font-black text-blue-700">${o.UTR_ID}</p>
                    </div>
                    <div class="flex gap-2">
                        <a href="${o.Location}" target="_blank" class="flex-1 bg-slate-800 text-white text-center py-3 rounded-xl text-xs font-bold uppercase">Open Map</a>
                        <button onclick="window.open('https://wa.me/91${o.CustomerMobile}?text=Hello, your order ${o.OrderID} is received.')" class="flex-1 bg-green-500 text-white py-3 rounded-xl text-xs font-bold uppercase">WhatsApp</button>
                    </div>
                </div>`;
            });
            document.getElementById('admin-orders-list').innerHTML = template || "<p class='text-center text-slate-400 py-20'>No Active Orders Found.</p>";
        }
    </script>
</body>
</html>
